# GCP ã¨ OCI ã‚’ã¤ãªãï¼Partner Interconnect Ã— FastConnect æ§‹æˆã‚’è§£èª¬

## ã¯ã˜ã‚ã«

ã¯ã˜ã‚ã¾ã—ã¦ï¼ [ã‚¢ãƒƒãƒ—ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰](https://appleworld.co.jp)ã§ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢æ‹…å½“ã—ã¦ã„ã‚‹å¤§ä¹…ä¿ã§ã™ã€‚

ã‚¢ãƒƒãƒ—ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰ã§ã¯ã€B2Bå‘ã‘ãƒ›ãƒ†ãƒ«äºˆç´„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã« Oracle Cloud Infrastructureï¼ˆOCIï¼‰ ã® Oracle DB ã¨ã€WEBã‚µãƒ¼ãƒã« Google Cloud Platform(GCP) ã‚’ä½¿ç”¨ã—ã¦ã‚‹ã¨ã„ã†ã€ã¡ã‚‡ã£ã¨ç‰¹æ®Šãªæ§‹æˆã ã£ãŸã‚Šã—ã¾ã™ã€‚

â€» ã‚ªãƒ³ãƒ—ãƒ¬ã‹ã‚‰ã‚¯ãƒ©ã‚¦ãƒ‰ç§»è¡Œã—ãŸå½“æ™‚(2019å¹´)ã¯ã€ GCP å´ã« Oracle DB ã‚’æ§‹ç¯‰ã™ã‚‹æ‰‹æ®µãŒã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çš„ã«ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã—ã‹å­˜åœ¨ã—ãªã‹ã£ãŸãŸã‚ã“ã®æ§‹æˆã§ã—ãŸã€‚

ãã‚“ãªãƒ‹ãƒƒãƒãªæ§‹æˆã§ã™ãŒã€  
- ã€Œãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ã‚„ã£ã¦ã¿ãŸã„ã‘ã©ã€ã‚¯ãƒ©ã‚¦ãƒ‰é–“ã®æ¥ç¶šã£ã¦ã©ã†ã‚„ã‚‹ã®ï¼Ÿã€
- ã€ŒGCP ã¨ OCI ä¸¡æ–¹ä½¿ã£ã¦ã‚‹ã‘ã©ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ç¹‹ã’ãŸã„...ã€
- ã€ŒTerraform ã§ã‚¯ãƒ©ã‚¦ãƒ‰é–“æ¥ç¶šã‚’è©¦ã—ãŸã„æ–¹ã€

ã“ã‚“ãªæ‚©ã¿ã‚’æŒã£ã¦ã„ã‚‹æ–¹ã¸
**GCP** ã¨ **OCI** ã‚’ã€ä»®æƒ³å°‚ç”¨ç·šã§æ¥ç¶šã™ã‚‹ã¿ãŸã„ãªéœ€è¦ã¯å°‘ãªã„ã§ã™ãŒã€Terraform ã‚’ä½¿ãˆã°æ„å¤–ã¨ç°¡å˜ã«ã‚¯ãƒ©ã‚¦ãƒ‰é–“æ¥ç¶šãŒã§ãã¡ã‚ƒã†ã‚“ã§ã™ï¼

ãã“ã§ Terraform ã‚’ä½¿ã£ã¦ã€**GCP Cloud Interconnectï¼ˆPartner Interconnectï¼‰** ã¨ **OCI FastConnect** ã‚’çµ„ã¿åˆã‚ã›ã¦ã€å®Ÿéš›ã«å‹•ã Terraform ã‚³ãƒ¼ãƒ‰ã‚’äº¤ãˆãªãŒã‚‰ã€GCP ã¨ OCI ã‚’æ¥ç¶šã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

---

### å‰æã¨ãªã‚‹çŸ¥è­˜ãƒ»è¨­å®š

ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã«ã‚ãŸã£ã¦ã€ä»¥ä¸‹ã®çŸ¥è­˜ãŒã‚ã‚‹ã¨ã‚¹ãƒ ãƒ¼ã‚ºã«ç†è§£ã§ãã‚‹ã¨æ€ã„ã¾ã™ï¼

- **Terraform ã®åŸºæœ¬æ“ä½œ**ï¼š`terraform apply` ãŒä½¿ãˆã‚‹
- **GCP ã®åŸºç¤çŸ¥è­˜ã¨ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼šVirtual Private Cloud(VPC)ã€ã‚µãƒ–ãƒãƒƒãƒˆã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚ãŸã‚ŠãŒã‚ã‹ã‚Šã€ç®¡ç†æ¨©é™ã¨ã€ gcloud ã‚³ãƒãƒ³ãƒ‰ã§æ¥ç¶šã§ãã¦ã‚‹äº‹ãŒå¿…è¦
- **OCI ã®åŸºç¤çŸ¥è­˜ã¨ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼šVirtual Cloud Network(VCN)ã€ã‚µãƒ–ãƒãƒƒãƒˆã€ã‚³ãƒ³ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚ãŸã‚ŠãŒã‚ã‹ã‚Šã€ç®¡ç†æ¨©é™ã¨ã€ oci-cli ã‚³ãƒãƒ³ãƒ‰ã§æ¥ç¶šã§ãã¦ã‚‹äº‹ãŒå¿…è¦
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åŸºç¤**ï¼šCIDR è¡¨è¨˜ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®åŸºæœ¬çš„ãªæ¦‚å¿µ
- **BGP ã®æ¦‚è¦**ï¼šã€Œãƒ«ãƒ¼ã‚¿ãƒ¼ãŒçµŒè·¯æƒ…å ±ã‚’äº¤æ›ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€ãã‚‰ã„ã®ç†è§£ã§OK

å…¨éƒ¨å®Œç’§ã«ã‚ã‹ã£ã¦ãªãã¦ã‚‚å¤§ä¸ˆå¤«ï¼è¨˜äº‹ã®ä¸­ã§ã‚‚èª¬æ˜ã—ã¦ã„ãã®ã§ã€æ°—è»½ã«èª­ã¿é€²ã‚ã¦ãã ã•ã„ã­ã€‚

### è§£èª¬ã¯é£›ã°ã—ã¦ ã‚µã‚¯ãƒƒã¨ Terraform ã§å‹•ä½œã•ã›ãŸã„æ–¹å‘ã‘

[ã“ã¡ã‚‰ã® github ãƒªãƒã‚¸ãƒˆãƒª](git@github.com:take-ookubo/terraform_for_gcp_oci_interconnect.git) ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ã¦ã¾ã™ã®ã§ã€git ã¨ terraform ãŒå‹•ä½œã™ã‚‹ç’°å¢ƒã§ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ã€‚

**é‡è¦ï¼š ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹ãŸã‚ã€2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¿…è¦ã§ã™**

GCP ã® VLAN Attachment ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’ OCI ã® Virtual Circuit ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€Terraform ã‚’2å›ã«åˆ†ã‘ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
# NOTE: gcloud, oci-cli ã‚³ãƒãƒ³ãƒ‰ã¯äº‹å‰ã«è¨­å®šã—ã¦ãŠã
git clone git@github.com:take-ookubo/terraform_for_gcp_oci_interconnect.git
cd terraform_for_gcp_oci_interconnect

# example ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ terraform.tfvars ã‚’å„è‡ªã®ç’°å¢ƒã«ã‚ã‚ã›ã¦ä¿®æ­£ã™ã‚‹ï¼ˆgcp_pairing_key ã¯ç©ºã®ã¾ã¾ï¼‰
cp terraform.tfvars.example terraform.tfvars

#===================================
# ã€ç¬¬1æ®µéšã€‘GCP ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
#===================================
terraform init
terraform plan
terraform apply
# â†’ GCP ã® VLAN Attachment ã¨ OCI ã® VCN/DRG ãŒä½œæˆã•ã‚Œã‚‹
# â†’ OCI Virtual Circuit ã¯ã¾ã ä½œæˆã•ã‚Œãªã„

#===================================
# ã€ç¬¬2æ®µéšã€‘OCI Virtual Circuit ã‚’ä½œæˆ
#===================================
# ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’å–å¾—
terraform output gcp_interconnect_attachment_pairing_key
# å‡ºåŠ›ä¾‹: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/asia-northeast1/1"

# terraform.tfvars ã«ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’è¿½åŠ 
# gcp_pairing_key = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/asia-northeast1/1"

# å†åº¦é©ç”¨
terraform apply
# â†’ OCI Virtual Circuit ãŒä½œæˆã•ã‚Œã‚‹

# æ¤œè¨¼çµ‚ã‚ã£ãŸã‚‰å‰Šé™¤ã™ã‚‹
terraform destroy
```

---

## âš ï¸ é‡è¦ï¼šæœ¬æ§‹æˆã¯å†—é•·æ§‹æˆã§ã¯ã‚ã‚Šã¾ã›ã‚“

**æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹æ§‹æˆã¯ã€æ¤œè¨¼ãƒ»å­¦ç¿’ç›®çš„ã®ã‚·ãƒ³ã‚°ãƒ«æ§‹æˆã§ã™ã€‚**

ä»®æƒ³å°‚ç”¨ç·šã‚„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼è¨­å‚™ã«éšœå®³ãŒç™ºç”Ÿã—ãŸå ´åˆã€æœ¬æ§‹æˆã§ã¯ **é€šä¿¡ãŒå®Œå…¨ã«åœæ­¢** ã—ã¾ã™ã€‚
æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšå†—é•·æ§‹æˆã‚’ `å¿…ãš` æ¤œè¨ã—ã¦ãã ã•ã„ï¼

---

### ä»Šå›ã®æ§‹æˆã®ãƒã‚¤ãƒ³ãƒˆ

ä»Šå›ä½œã‚‹æ§‹æˆã®ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ï¼š

- **Terraform** ã§å…¨éƒ¨ã‚³ãƒ¼ãƒ‰åŒ–ï¼ˆä½•åº¦ã§ã‚‚å†ç¾ã§ãã‚‹ï¼ï¼‰
- **BGP** ã§å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆçµŒè·¯ã‚’è‡ªå‹•ã§äº¤æ›ã—ã¦ãã‚Œã‚‹ï¼‰

ãã‚Œã§ã¯ã€ã•ã£ããè¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

## å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã¾ãšã¯ã€å…¨ä½“åƒã‚’å›³ã§è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³](https://github.com/take-ookubo/terraform_for_gcp_oci_interconnect/blob/main/architecture_drawio.png?raw=true)

## Terraform ã®æ§‹ç¯‰ã®æµã‚Œ

å®Ÿéš›ã«æ§‹ç¯‰ã™ã‚‹å ´åˆã®å¤§ã¾ã‹ãªæµã‚Œã§ã™ã€‚

### ãªãœ2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

GCP ã¨ OCI ã‚’æ¥ç¶šã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ä¾å­˜é–¢ä¿‚ãŒã‚ã‚Šã¾ã™ï¼š

```
GCP VLAN Attachment ä½œæˆ
        â†“
  ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ç™ºè¡Œ
        â†“
OCI Virtual Circuit ä½œæˆï¼ˆãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ãŒå¿…è¦ï¼‰
```

ã¤ã¾ã‚Šã€**GCP ã® VLAN Attachment ã‚’å…ˆã«ä½œæˆã—ãªã„ã¨ã€OCI ã® Virtual Circuit ã«å¿…è¦ãªãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ãŒæ‰‹ã«å…¥ã‚‰ãªã„** ã‚“ã§ã™ã€‚

Terraform ã¯é€šå¸¸ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¸€åº¦ã«ä½œæˆã—ã‚ˆã†ã¨ã—ã¾ã™ãŒã€ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã¨ã„ã†ã€Œå®Ÿè¡Œæ™‚ã«åˆã‚ã¦å¾—ã‚‰ã‚Œã‚‹å€¤ã€ãŒå¿…è¦ãªãŸã‚ã€2æ®µéšã«åˆ†ã‘ã¦å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### Step 1: ç¬¬1æ®µéš - GCP ãƒªã‚½ãƒ¼ã‚¹ + OCI åŸºç›¤ã®ä½œæˆ

æœ€åˆã® `terraform apply` ã§ä»¥ä¸‹ãŒä½œæˆã•ã‚Œã¾ã™ï¼š

**GCP å´ï¼š**
1. VPC ã‚’ä½œæˆ
2. ã‚µãƒ–ãƒãƒƒãƒˆã‚’ä½œæˆ
3. Cloud Router ã‚’ä½œæˆ
4. VLAN Attachment ã‚’ä½œæˆ â†’ **ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ãŒç™ºè¡Œã•ã‚Œã‚‹**

**OCI å´ï¼š**
1. VCN ã‚’ä½œæˆ
2. ã‚µãƒ–ãƒãƒƒãƒˆã‚’ä½œæˆ
3. DRG ã‚’ä½œæˆ
4. DRG ã‚’ VCN ã«ã‚¢ã‚¿ãƒƒãƒ
5. ~~Virtual Circuit ã‚’ä½œæˆ~~ â†’ **ã¾ã ä½œæˆã—ãªã„**ï¼ˆãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ãŒãªã„ãŸã‚ï¼‰

### Step 2: ç¬¬2æ®µéš - OCI Virtual Circuit ã®ä½œæˆ

1. `terraform output` ã§ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’å–å¾—
2. `terraform.tfvars` ã«ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’è¨­å®š
3. å†åº¦ `terraform apply` â†’ **OCI Virtual Circuit ãŒä½œæˆã•ã‚Œã‚‹**

### Step 3: æ¥ç¶šç¢ºèª
1. GCP å´ã§ VLAN Attachment ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª
2. OCI å´ã§ Virtual Circuit ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª
3. ç–é€šãƒ†ã‚¹ãƒˆï¼ˆping ãªã©ï¼‰

---

## å„ç’°å¢ƒã”ã¨ã®å¤‰æ•°ã®æ›´æ–°

Terraform ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€`terraform.tfvars` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ã€å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ãŸå€¤ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### è¨­å®šãŒå¿…è¦ãªå¤‰æ•°

#### GCP ã®è¨­å®šï¼ˆå¿…é ˆï¼‰

| å¤‰æ•°å | èª¬æ˜ | ç¢ºèªæ–¹æ³• |
|--------|------|----------|
| `gcp_project_id` | GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ID | GCP ã‚³ãƒ³ã‚½ãƒ¼ãƒ« â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ |

#### OCI ã®è¨­å®šï¼ˆå¿…é ˆï¼‰

| å¤‰æ•°å | èª¬æ˜ | ç¢ºèªæ–¹æ³• |
|--------|------|----------|
| `oci_tenancy_ocid` | ãƒ†ãƒŠãƒ³ã‚·ãƒ¼ OCID | OCI ã‚³ãƒ³ã‚½ãƒ¼ãƒ« â†’ Profile â†’ Tenancy |
| `oci_compartment_id` | ã‚³ãƒ³ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ OCID | OCI ã‚³ãƒ³ã‚½ãƒ¼ãƒ« â†’ Identity â†’ Compartments |
| `oci_user_ocid` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ OCID | OCI ã‚³ãƒ³ã‚½ãƒ¼ãƒ« â†’ Profile â†’ User Settings |
| `oci_fingerprint` | API ã‚­ãƒ¼ã®ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ | OCI ã‚³ãƒ³ã‚½ãƒ¼ãƒ« â†’ Profile â†’ API Keys |
| `oci_private_key_path` | API ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ¼ã®ãƒ‘ã‚¹ | ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ãŸã‚­ãƒ¼ã®ãƒ•ãƒ«ãƒ‘ã‚¹ |

#### 2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã®è¨­å®š

| å¤‰æ•°å | èª¬æ˜ | è¨­å®šã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|--------|------|----------------|
| `gcp_pairing_key` | GCP VLAN Attachment ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ | **ç¬¬2æ®µéšã§è¨­å®š** |

### terraform.tfvars ã®è¨­å®šä¾‹

```hcl
# =============================================================================
# GCP Variables
# =============================================================================
gcp_project_id = "YOUR-GCP-PROJECT-ID"

# =============================================================================
# OCI Variables
# =============================================================================
oci_tenancy_ocid     = "ocid1.tenancy.oc1..aaaaaaaxxxxxxxxxx"
oci_compartment_id   = "ocid1.compartment.oc1..aaaaaaaxxxxxxxxxx"
oci_user_ocid        = "ocid1.user.oc1..aaaaaaaxxxxxxxxxx"
oci_fingerprint      = "aa:bb:cc:dd:ee:ff:00:11:22:33:44:55:66:77:88:99"
oci_private_key_path = "/home/user/.oci/oci_api_key.pem"

# =============================================================================
# 2æ®µéšãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ï¼ˆç¬¬1æ®µéšã§ã¯ç©ºã®ã¾ã¾ï¼‰
# =============================================================================
# ç¬¬1æ®µéšã® terraform apply å®Œäº†å¾Œã€å‡ºåŠ›ã•ã‚ŒãŸãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’è¨­å®š
# gcp_pairing_key = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/asia-northeast1/1"
```

### ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã®è¨­å®šæ‰‹é †

1. **ç¬¬1æ®µéš**: `gcp_pairing_key` ã¯è¨­å®šã›ãšã« `terraform apply` ã‚’å®Ÿè¡Œ
2. **ãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã‚’å–å¾—**: `terraform output gcp_interconnect_attachment_pairing_key`
3. **ç¬¬2æ®µéš**: å–å¾—ã—ãŸã‚­ãƒ¼ã‚’ `terraform.tfvars` ã«è¨­å®šã—ã¦å†åº¦ `terraform apply`

---

## å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è©³ã—ãè§£èª¬

### GCP å´ã§è‚ã«ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. Cloud Router

Cloud Router ã¯ã€**ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’è‡ªå‹•çš„ã«ã‚„ã‚Šå–ã‚Šã™ã‚‹** ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

BGPï¼ˆBorder Gateway Protocolï¼‰ã¨ã„ã†ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ã£ã¦ã€ã€Œã“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®é€šä¿¡ã¯ã€ã“ã£ã¡ã«é€ã£ã¦ã­ã€ã¨ã„ã†æƒ…å ±ã‚’è‡ªå‹•çš„ã«äº¤æ›ã—ã¾ã™ã€‚

```hcl
resource "google_compute_router" "router" {
  name    = "gcp-oci-vpc-router"
  region  = "asia-northeast1"
  network = google_compute_network.vpc.id

  bgp {
    asn = 16550  # GCP ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ ASN
  }
}
```

> ğŸ’¡ ASNï¼ˆAutonomous System Numberï¼‰ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ç•ªå·ã§ã™ã€‚GCP ã¯ 16550 ã‚’ä½¿ã„ã¾ã™ã€‚

#### 2. VLAN Attachmentï¼ˆPartner Interconnectï¼‰

VLAN Attachment ã¯ã€**ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼äº‹æ¥­è€…ã¨ã®æ¥ç¶šãƒã‚¤ãƒ³ãƒˆ** ã§ã™ã€‚

ã“ã‚Œã‚’ä½œæˆã™ã‚‹ã¨ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã‚­ãƒ¼ã€ãŒç™ºè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®ã‚­ãƒ¼ã‚’ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼äº‹æ¥­è€…ï¼ˆEquinix ã‚„ Megaport ãªã©ï¼‰ã«ä¼ãˆã‚‹ã“ã¨ã§ã€æ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã¾ã™ã€‚

```hcl
resource "google_compute_interconnect_attachment" "partner_interconnect" {
  name   = "gcp-oci-vpc-partner-interconnect"
  region = "asia-northeast1"
  router = google_compute_router.router.id
  type   = "PARTNER"
}
```

---

### OCI å´ã§è‚ã«ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. DRGï¼ˆDynamic Routing Gatewayï¼‰

DRG ã¯ã€**VCN ã®å¤–éƒ¨ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®ç„é–¢å£** ã§ã™ã€‚

VCN ã‹ã‚‰å¤–éƒ¨ï¼ˆä»Šå›ã¯ GCPï¼‰ã¸å‡ºã¦ã„ãé€šä¿¡ã¯ã€ã™ã¹ã¦ã“ã® DRG ã‚’çµŒç”±ã—ã¾ã™ã€‚GCP ã® Cloud Router ã«ç›¸å½“ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

```hcl
resource "oci_core_drg" "drg" {
  compartment_id = var.compartment_id
  display_name   = "oci-gcp-vcn-drg"
}
```

DRG ã‚’ä½œæˆã—ãŸã‚‰ã€VCN ã«ã‚¢ã‚¿ãƒƒãƒï¼ˆæ¥ç¶šï¼‰ã—ã¾ã™ã€‚

```hcl
resource "oci_core_drg_attachment" "drg_attachment" {
  drg_id = oci_core_drg.drg.id
  network_details {
    id   = oci_core_vcn.vcn.id
    type = "VCN"
  }
}
```

#### 2. Virtual Circuitï¼ˆFastConnectï¼‰

Virtual Circuit ã¯ã€**FastConnect ã®è«–ç†çš„ãªæ¥ç¶š** ã§ã™ã€‚

GCP ã® VLAN Attachment ã«ç›¸å½“ã—ã¾ã™ã€‚ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼äº‹æ¥­è€…ã‚’çµŒç”±ã—ã¦ã€GCP ã¨æ¥ç¶šã™ã‚‹ãŸã‚ã®è¨­å®šã§ã™ã€‚

```hcl
resource "oci_core_virtual_circuit" "virtual_circuit" {
  compartment_id       = var.compartment_id
  display_name         = "oci-gcp-vcn-virtual-circuit"
  type                 = "PRIVATE"
  bandwidth_shape_name = "1 Gbps"
  gateway_id           = oci_core_drg.drg.id
}
```

---

### ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

GCP ã¨ OCI ã‚’ç›´æ¥ã¤ãªãã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚é–“ã« **ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼äº‹æ¥­è€…** ãŒå…¥ã‚Šã¾ã™ã€‚

ä¸»ãªãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼äº‹æ¥­è€…ï¼š
- **Equinix Fabric** - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å±•é–‹ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼äº‹æ¥­è€…
- **Megaport** - ã‚¯ãƒ©ã‚¦ãƒ‰æ¥ç¶šã«ç‰¹åŒ–ã—ãŸäº‹æ¥­è€…
- **Console Connectï¼ˆPCCWï¼‰** - ã‚¢ã‚¸ã‚¢ã«å¼·ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯äº‹æ¥­è€…

ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼äº‹æ¥­è€…ã¯ã€è‡ªç¤¾ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ã¦ GCP ã¨ OCI ã®é–“ã‚’ã¤ãªã„ã§ãã‚Œã¾ã™ã€‚

---

## é€šä¿¡ã®æµã‚Œ

GCP ã® VM ã‹ã‚‰ OCI ã® VM ã¸é€šä¿¡ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®æµã‚Œã«ãªã‚Šã¾ã™ã€‚

```
GCP VM (10.0.0.10)
    â†“
GCP Subnet
    â†“
Cloud Routerï¼ˆBGP ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
    â†“
VLAN Attachment
    â†“
Partner Provider ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
    â†“
Virtual Circuitï¼ˆFastConnectï¼‰
    â†“
DRGï¼ˆBGP ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
    â†“
OCI Subnet
    â†“
OCI VM (192.168.0.10)
```

BGP ã«ã‚ˆã£ã¦ã€ã€Œ10.0.0.0/24 ã¯ GCP ã«ã‚ã‚‹ã€ã€Œ192.168.0.0/24 ã¯ OCI ã«ã‚ã‚‹ã€ã¨ã„ã†æƒ…å ±ãŒè‡ªå‹•çš„ã«äº¤æ›ã•ã‚Œã‚‹ãŸã‚ã€æ‰‹å‹•ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹å¿…è¦ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®æœ¬è³ªã‹ã‚‰ç†è§£ã§ãã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€ŒBGPã€ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸï¼](https://qiita.com/x5dwimpejx/items/2a84b3466c7b834d5853#bgp%E3%81%A3%E3%81%A6)
â€» BGP ã®æ¦‚å¿µã¯ã€ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒé¨“è€…ã§ã‚‚ã‚ã‹ã‚Šã¥ã‚‰ã„ã®ã§ã€éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸ

- [VLAN ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆ è¨­è¨ˆå®Œå…¨ã‚¬ã‚¤ãƒ‰](https://zenn.dev/cloud_ace/articles/vlan-attachment-how-to-planning)
â€» BGP ã®æ¬¡ã« VLAN ã®æ¦‚å¿µãŒã‚ã‹ã‚Šã¥ã‚‰ã„ã®ã§ã€éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸ

#### å„ã‚¯ãƒ©ã‚¦ãƒ‰ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [GCP Partner Interconnect ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/network-connectivity/docs/interconnect/concepts/partner-overview)
- [OCI FastConnect ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/fastconnect.htm)
